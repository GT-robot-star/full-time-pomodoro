<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¤¾ä¼šäººãƒãƒ¢ãƒ‰ãƒ¼ãƒ­</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 50px;
    }
    #timer {
      font-size: 48px;
      margin: 20px;
    }
    button {
      font-size: 18px;
      margin: 5px;
      padding: 10px 20px;
    }
  </style>
</head>
<h1>ç¤¾ä¼šäººãƒãƒ¢ãƒ‰ãƒ¼ãƒ­</h1>
<div id="timer">25:00</div>
<div id="status">ä½œæ¥­ä¸­</div>
<div id="cycles">ã‚µã‚¤ã‚¯ãƒ«: 0</div>
<div id="total">åˆè¨ˆä½œæ¥­æ™‚é–“: 0åˆ†</div>
<button id="startBtn">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<button id="pauseBtn">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
<button id="resetBtn">â¹ ãƒªã‚»ãƒƒãƒˆ</button>
<button id="settingsBtn">âš™ è¨­å®š</button>

<!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="settingsModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
  <div style="background:#fff; padding:20px; margin:100px auto; width:300px; border-radius:8px;">
    <h2>è¨­å®š</h2>
    <label>ä½œæ¥­æ™‚é–“(åˆ†): <input type="number" id="workInput" value="25"></label><br><br>
    <label>ä¼‘æ†©æ™‚é–“(åˆ†): <input type="number" id="breakInput" value="5"></label><br><br>
    <label>é•·ä¼‘æ†©æ™‚é–“(åˆ†): <input type="number" id="longBreakInput" value="15"></label><br><br>
    <label>é•·ä¼‘æ†©ã¾ã§ã®ã‚µã‚¤ã‚¯ãƒ«æ•°: <input type="number" id="cycleInput" value="4"></label><br><br>
    <label>1æ—¥ã®ç›®æ¨™æ™‚é–“(æ™‚é–“): <input type="number" id="goalInput" value="8"></label><br><br>
    <button id="saveSettings">ä¿å­˜</button>
    <button id="closeSettings">é–‰ã˜ã‚‹</button>
  </div>
</div>


  <script>
let workMinutes = 25;
let breakMinutes = 5;
let longBreakMinutes = 15;
let cyclesBeforeLongBreak = 4;
let dailyGoalHours = 8;

let time = workMinutes * 60;
let startTime = null;      // ã‚«ã‚¦ãƒ³ãƒˆé–‹å§‹æ™‚åˆ»
let remainingTime = null;  // ä¸€æ™‚åœæ­¢ã‚„å†é–‹ã«ä½¿ã†æ®‹ã‚Šæ™‚é–“
let isWorking = true;
let timerInterval;
let cycleCount = 0;
let totalWorkMinutes = 0;

const timerDisplay = document.getElementById("timer");
const statusDisplay = document.getElementById("status");
const cyclesDisplay = document.getElementById("cycles");
const totalDisplay = document.getElementById("total");
const startBtn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");

const settingsBtn = document.getElementById("settingsBtn");
const settingsModal = document.getElementById("settingsModal");
const workInput = document.getElementById("workInput");
const breakInput = document.getElementById("breakInput");
const longBreakInput = document.getElementById("longBreakInput");
const cycleInput = document.getElementById("cycleInput");
const goalInput = document.getElementById("goalInput");
const saveSettings = document.getElementById("saveSettings");
const closeSettings = document.getElementById("closeSettings");

function updateDisplay() {
  let minutes = Math.floor(time / 60);
  let seconds = time % 60;
  timerDisplay.textContent =
    String(minutes).padStart(2, "0") + ":" + String(seconds).padStart(2, "0");
  cyclesDisplay.textContent = "ã‚µã‚¤ã‚¯ãƒ«: " + cycleCount;
  totalDisplay.textContent =
    "åˆè¨ˆä½œæ¥­æ™‚é–“: " + totalWorkMinutes + "åˆ† / ç›®æ¨™ " + (dailyGoalHours * 60) + "åˆ†";
}

function startTimer() {
  if (!timerInterval) {
    // åˆå› or å†é–‹
    if (!remainingTime) {
      remainingTime = time;
    }
    startTime = Date.now();

    timerInterval = setInterval(() => {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const currentTime = remainingTime - elapsed;

      if (currentTime > 0) {
        time = currentTime;
        updateDisplay();
      } else {
        clearInterval(timerInterval);
        timerInterval = null;
        remainingTime = null;

        if (isWorking) {
          cycleCount++;
          totalWorkMinutes += workMinutes;
          if (cycleCount % cyclesBeforeLongBreak === 0) {
            alert("ä½œæ¥­çµ‚äº†ï¼é•·ä¼‘æ†©ã«å…¥ã‚Šã¾ã—ã‚‡ã†ã€‚");
            time = longBreakMinutes * 60;
            statusDisplay.textContent = "é•·ä¼‘æ†©ä¸­";
          } else {
            alert("ä½œæ¥­çµ‚äº†ï¼ä¼‘æ†©ã—ã¾ã—ã‚‡ã†ã€‚");
            time = breakMinutes * 60;
            statusDisplay.textContent = "ä¼‘æ†©ä¸­";
          }
          isWorking = false;
        } else {
          alert("ä¼‘æ†©çµ‚äº†ï¼ä½œæ¥­ã‚’å†é–‹ã—ã¾ã—ã‚‡ã†ã€‚");
          time = workMinutes * 60;
          statusDisplay.textContent = "ä½œæ¥­ä¸­";
          isWorking = true;
        }
        updateDisplay();

        // ç›®æ¨™é”æˆãƒã‚§ãƒƒã‚¯
        if (totalWorkMinutes >= dailyGoalHours * 60) {
          alert("ğŸ‰ ä»Šæ—¥ã®ç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸï¼ãŠç–²ã‚Œã•ã¾ï¼");
          resetTimer();
        }
      }
    }, 1000);
  }
}


function resetTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
  remainingTime = null; 
  isWorking = true;
  cycleCount = 0;
  totalWorkMinutes = 0;
  time = workMinutes * 60;
  statusDisplay.textContent = "ä½œæ¥­ä¸­";
  updateDisplay();
}


function pauseTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
    // æ®‹ã‚Šæ™‚é–“ã‚’ä¿å­˜
    remainingTime = time;
  }
}


// è¨­å®šã‚’ä¿å­˜
saveSettings.addEventListener("click", () => {
  workMinutes = parseInt(workInput.value);
  breakMinutes = parseInt(breakInput.value);
  longBreakMinutes = parseInt(longBreakInput.value);
  cyclesBeforeLongBreak = parseInt(cycleInput.value);
  dailyGoalHours = parseInt(goalInput.value);

  resetTimer(); // è¨­å®šå¤‰æ›´å¾Œã«ãƒªã‚»ãƒƒãƒˆ
  settingsModal.style.display = "none";

  // ä¿å­˜ã—ã¦æ¬¡å›èµ·å‹•æ™‚ã«ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
  localStorage.setItem("pomodoroSettings", JSON.stringify({
    workMinutes, breakMinutes, longBreakMinutes, cyclesBeforeLongBreak, dailyGoalHours
  }));
});

// è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‹é–‰
settingsBtn.addEventListener("click", () => {
  settingsModal.style.display = "block";
});
closeSettings.addEventListener("click", () => {
  settingsModal.style.display = "none";
});

// ä¿å­˜ã•ã‚ŒãŸè¨­å®šã‚’èª­ã¿è¾¼ã‚€
window.onload = () => {
  const saved = localStorage.getItem("pomodoroSettings");
  if (saved) {
    const s = JSON.parse(saved);
    workMinutes = s.workMinutes;
    breakMinutes = s.breakMinutes;
    longBreakMinutes = s.longBreakMinutes;
    cyclesBeforeLongBreak = s.cyclesBeforeLongBreak;
    dailyGoalHours = s.dailyGoalHours;

    workInput.value = workMinutes;
    breakInput.value = breakMinutes;
    longBreakInput.value = longBreakMinutes;
    cycleInput.value = cyclesBeforeLongBreak;
    goalInput.value = dailyGoalHours;
  }
  resetTimer();
};

startBtn.addEventListener("click", startTimer);
resetBtn.addEventListener("click", resetTimer);
document.getElementById("pauseBtn").addEventListener("click", pauseTimer);


updateDisplay();
  </script>
</body>
</html>
